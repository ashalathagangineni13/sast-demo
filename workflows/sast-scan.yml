# inside jobs.semgrep.steps (replace your existing "Run Semgrep scan" + upload steps)

- name: Install Python & Semgrep
  uses: actions/setup-python@v4
  with:
    python-version: '3.x'

- name: Run Semgrep and produce SARIF
  run: |
    pip install semgrep
    # generate SARIF output
    semgrep --config=auto --sarif --output=semgrep.sarif .

- name: Install Node (for SARIF -> HTML converter)
  uses: actions/setup-node@v4
  with:
    node-version: '20'

- name: Install sarif-explorer (example converter) and convert to HTML
  run: |
    # sarif-explorer is an example npm tool that converts SARIF -> interactive HTML
    # you can replace this with another converter (qodana/sarif-converter, microsoft sarif-tools, etc.)
    npm install -g sarif-explorer || true
    # If sarif-explorer binary is 'sarif-explorer' and supports input-output:
    # (some tools expose slightly different CLIs â€” check the tool's README)
    if command -v sarif-explorer >/dev/null 2>&1; then
      sarif-explorer semgrep.sarif -o semgrep-report.html || echo "sarif-explorer failed"
    else
      echo "sarif-explorer not available; listing SARIF file"
      ls -la semgrep.sarif
    fi

- name: Upload SARIF + HTML report artifacts
  uses: actions/upload-artifact@v3
  with:
    name: semgrep-reports
    path: |
      semgrep.sarif
      semgrep-report.html

